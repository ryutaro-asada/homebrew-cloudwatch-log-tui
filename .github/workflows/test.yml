name: Test Formula

on:
  push:
    paths:
      - 'Formula/**.rb'
      - 'scripts/**.sh'
      - '.github/workflows/test.yml'
  pull_request:
    paths:
      - 'Formula/**.rb'
      - 'scripts/**.sh'

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Setup Ruby
      uses: ruby/setup-ruby@v1
      with:
        ruby-version: '3.2'
    
    - name: Make scripts executable
      run: |
        chmod +x scripts/*.sh
    
    - name: Test Formula syntax
      run: |
        ./scripts/test-formula.sh
    
    - name: Validate Formula with Homebrew
      run: |
        # Homebrewのインストール（GitHub Actions用の軽量版）
        /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)" < /dev/null
        
        # Formula の audit（構文チェック）
        export PATH="/home/linuxbrew/.linuxbrew/bin:$PATH"
        brew audit --strict Formula/cloudwatch-log-tui.rb || true
